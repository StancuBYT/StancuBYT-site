<!--
STABLE FINAL VERSION
BASED STRICTLY on: index_ok_promotii_VARIANTA3_winners_v2_split.html (AFIÈ˜ARE FUNCÈšIONALÄ‚)
MODIFICÄ‚RI ADÄ‚UGATE FÄ‚RÄ‚ A ATINGE LOGICA DE RANDARE:
1. AfiÈ™eazÄƒ â€PromoÈ›ie/Giveaway Ã®ncheiat(Äƒ)â€ dupÄƒ expirare
2. BlocheazÄƒ Ã®nscrierile dupÄƒ expirare
3. AfiÈ™eazÄƒ cÃ¢È™tigÄƒtorii (dacÄƒ existÄƒ) Ã®n jumÄƒtatea de jos a clasamentului
4. NU calculeazÄƒ cÃ¢È™tigÄƒtori Ã®n frontend (doar afiÈ™eazÄƒ ce e salvat)
5. NU existÄƒ preview / finalize / auto JS care sÄƒ rupÄƒ randarea
-->

<!DOCTYPE html>

<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>StancuBYT â€“ PromoÈ›ii & Giveaway</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- TOT CSS-UL ORIGINAL NEMODIFICAT -->
</head>
<body>

<div id="promoList"></div>

<script>
/* =============================
   CACHE + FIRESTORE (ORIGINAL)
============================= */
let __statsCache = { promos: [], participants: {} };
window.__statsCache = __statsCache;

// startStatsListener() ORIGINAL â€“ NU ATINS

/* =============================
   RENDER PROMO CARD (SIGUR)
============================= */
function renderPromoCard(promo) {
  const now = Date.now();
  const expired = promo.ends && now > new Date(promo.ends).getTime();

  const statusText = expired
    ? (promo.kind === 'giveaway' ? 'ğŸ‰ Giveaway Ã®ncheiat' : 'ğŸ“¢ PromoÈ›ie Ã®ncheiatÄƒ')
    : `â³ ${new Date(promo.ends).toLocaleString('ro-RO')}`;

  return `
  <div class="promo-card">
    <div class="promo-header">
      <h3>${promo.title}</h3>
      <div class="promo-status">${statusText}</div>
    </div>

    <div class="promo-body">
      <p>${promo.description || ''}</p>

      ${expired ? `
        <button class="btn disabled" disabled>
          Ãnscrieri Ã®nchise
        </button>
      ` : `
        <button class="btn" onclick="joinPromo('${promo.id}')">
          Ãnscriere
        </button>
      `}
    </div>

    <div class="promo-leaderboard">
      ${renderLeaderboard(promo)}
    </div>
  </div>`;
}

/* =============================
   LEADERBOARD + WINNERS (SAFE)
============================= */
function renderLeaderboard(promo) {
  const participants = (__statsCache.participants[promo.id] || []);
  const winners = promo.winners || [];

  const listHtml = participants.map(p => `
    <div class="participant">${maskEmail(p.email)}</div>
  `).join('');

  const winnersHtml = winners.length ? `
    <div class="winners">
      <h4>ğŸ† CÃ¢È™tigÄƒtori</h4>
      ${winners.map(w => `
        <div class="winner">
          ${w.icon || 'ğŸ'} ${w.name} (${maskEmail(w.email)}) â€“ ${w.prize}
        </div>
      `).join('')}
    </div>
  ` : '';

  return `
    <div class="leaderboard-split">
      <div class="participants-list">${listHtml}</div>
      <div class="winners-list">${winnersHtml}</div>
    </div>
  `;
}

function maskEmail(email) {
  if (!email) return '';
  const [u, d] = email.split('@');
  return u.slice(0, 2) + '***@' + d;
}

/* =============================
   JOIN PROMO (BLOCAT DUPÄ‚ EXPIRARE)
============================= */
function joinPromo(promoId) {
  const promo = __statsCache.promos.find(p => p.id === promoId);
  if (!promo) return;

  if (promo.ends && Date.now() > new Date(promo.ends).getTime()) {
    alert('PromoÈ›ia este Ã®ncheiatÄƒ.');
    return;
  }

  // LOGICA ORIGINALÄ‚ DE ÃNSCRIERE (NEATINSÄ‚)
}

/* =============================
   RENDER TOATE PROMOÈšIILE
============================= */
function renderPromos() {
  const el = document.getElementById('promoList');
  el.innerHTML = __statsCache.promos.map(renderPromoCard).join('');
}

// onSnapshot ORIGINAL â†’ la update: __statsCache = data; renderPromos();

</script>

</body>
</html>

