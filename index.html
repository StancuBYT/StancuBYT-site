<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StancuBYT | Statistici</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.1.1"></script>
  <style>
        /* Variabile culori conform psihologiei marketingului */
        :root {
            --blue-tech: #0066ff;
            --green-growth: #00ff88;
            --purple-innov: #8a2be2;
            --neon-cyan: #00ffff;
            --dark-bg: #0a0a1f;
            --darker-bg: #050510;
            --orange-alert: #ff9500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: white;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 102, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 60%, rgba(0, 255, 136, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 50% 80%, rgba(138, 43, 226, 0.1) 0%, transparent 20%);
        }

        /* Particle Animation Background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Logo Background pentru Hero Section */
        .hero-logo-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            opacity: 0.05;
            z-index: -1;
            pointer-events: none;
        }

        .logo-3d-bg {
            width: 100%;
            height: 100%;
            position: relative;
            animation: float3d 20s infinite ease-in-out;
        }

        .logo-3d-bg img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            filter: blur(1px) brightness(1.2);
        }

        @keyframes float3d {
            0%, 100% { 
                transform: translateY(0px) rotateX(0deg) rotateY(0deg); 
            }
            25% { 
                transform: translateY(-20px) rotateX(5deg) rotateY(5deg); 
            }
            50% { 
                transform: translateY(0px) rotateX(0deg) rotateY(10deg); 
            }
            75% { 
                transform: translateY(20px) rotateX(-5deg) rotateY(5deg); 
            }
        }

        /* 3D Logo Animation */
        .logo-3d-container {
            position: relative;
            width: 80px;
            height: 80px;
            perspective: 1000px;
        }

        .logo-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            animation: rotate3d 8s infinite linear;
        }

        .logo-3d img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            backface-visibility: hidden;
        }

        .backnote-orbit {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120px;
            height: 120px;
            transform: translate(-50%, -50%);
            animation: orbit 6s infinite linear;
        }

        .backnote {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--neon-cyan);
            border-radius: 50%;
            filter: blur(2px);
            opacity: 0.7;
        }

        .backnote:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%); }
        .backnote:nth-child(2) { top: 50%; right: 0; transform: translateY(-50%); }
        .backnote:nth-child(3) { bottom: 0; left: 50%; transform: translateX(-50%); }
        .backnote:nth-child(4) { top: 50%; left: 0; transform: translateY(-50%); }

        @keyframes rotate3d {
            0% { transform: rotateY(0deg) rotateX(5deg); }
            100% { transform: rotateY(360deg) rotateX(5deg); }
        }

        @keyframes orbit {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Buton Modern Re√ÆmprospƒÉteazƒÉ Datele */
        .btn-refresh-modern {
            background: linear-gradient(45deg, var(--blue-tech), var(--purple-innov));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            margin-top: 1rem;
            box-shadow: 0 5px 20px rgba(0, 102, 255, 0.3);
        }

        .btn-refresh-modern:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 102, 255, 0.5);
        }

        .btn-refresh-modern:active {
            transform: translateY(0) scale(1);
        }

        .refresh-icon {
            font-size: 1.3rem;
            transition: transform 0.5s ease;
        }

        .btn-refresh-modern:hover .refresh-icon {
            animation: rotate360 1s linear infinite;
        }

        .refresh-pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            border-radius: 50px;
            background: linear-gradient(45deg, var(--green-growth), var(--neon-cyan));
            opacity: 0;
            z-index: -1;
            animation: pulseEffect 2s infinite;
        }

        @keyframes rotate360 {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulseEffect {
            0% { 
                transform: scale(1); 
                opacity: 0.7; 
            }
            100% { 
                transform: scale(1.2); 
                opacity: 0; 
            }
        }

        /* Loading animation pentru buton */
        .btn-refresh-modern.loading {
            background: linear-gradient(45deg, #666, #888);
            cursor: wait;
        }

        .btn-refresh-modern.loading .refresh-icon {
            animation: rotate360 1s linear infinite;
        }

        .btn-refresh-modern.loading .refresh-text {
            opacity: 0.7;
        }

        /* Animatie pentru actualizare succes */
        @keyframes successFlash {
            0%, 100% { 
                background: linear-gradient(45deg, var(--blue-tech), var(--purple-innov)); 
            }
            50% { 
                background: linear-gradient(45deg, var(--green-growth), #00cc66); 
            }
        }

        .btn-refresh-modern.success {
            animation: successFlash 0.5s ease 2;
        }

        /* Main Content Sections */
        .page-section {
            min-height: 100vh;
            padding: 120px 2rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
            display: none;
            position: relative;
            overflow: hidden;
        }

        .active-section {
            display: block;
        }

        /* Scientific Data Visualization */
        .data-visualization {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 2rem 0;
        }

        .chart-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .period-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 102, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .period-btn.active {
            background: var(--blue-tech);
            border-color: var(--blue-tech);
        }

        .period-btn:hover {
            background: rgba(0, 102, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--neon-cyan);
            margin: 0.5rem 0;
        }

        .neon-glow {
            box-shadow: 
                0 0 20px rgba(0, 102, 255, 0.3),
                0 0 40px rgba(0, 255, 136, 0.2),
                inset 0 0 20px rgba(138, 43, 226, 0.1);
        }

        .token-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 102, 255, 0.3);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-10px);
            border-color: var(--green-growth);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .chart-container { height: 300px; }
            .btn-refresh-modern { padding: 0.8rem 1.5rem; font-size: 1rem; }
            .token-info-grid { grid-template-columns: 1fr; }
        }
  </style>
</head>
<body>
  <section id="statistici" class="page-section active-section">
        <div style="text-align: center; margin-bottom: 3rem; padding-top: 20px;">
            <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">AnalizƒÉ »òtiin»õificƒÉ √Æn Timp Real</h1>
            <p>Date live preluate de pe Etherscan</p>
            
            <button onclick="fetchAllData()" class="btn-refresh-modern" id="refreshButton">
                <span class="refresh-icon">üîÑ</span>
                <span class="refresh-text">Re√ÆmprospƒÉteazƒÉ Datele</span>
                <span class="refresh-pulse"></span>
            </button>
        </div>

        <div class="data-visualization neon-glow">
            <h3>üìà Pre»õ √Æn Timp Real</h3>
            <div id="sbyt-price-box" style="margin-top:14px; margin-bottom:10px;">
              <div style="font-size:18px; opacity:.85;">1 SBYT √Æn USD</div>
              <div id="sbyt-price" style="font-size:32px; font-weight:bold; color:var(--green-growth);">Se √ÆncarcƒÉ...</div>
            </div>

            <div class="chart-controls">
                <button class="period-btn active" onclick="changeChartPeriod('1h')">1H</button>
                <button class="period-btn" onclick="changeChartPeriod('24h')">24H</button>
                <button class="period-btn" onclick="changeChartPeriod('7d')">7 Zile</button>
                <button class="period-btn" onclick="changeChartPeriod('1m')">1 LunƒÉ</button>
                <button class="period-btn" onclick="changeChartType('candlestick')">Lum√¢nƒÉri</button>
                <button class="period-btn" onclick="changeChartType('line')">Linie</button>
            </div>
            
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
            <div id="priceData" class="loading">Se √ÆncarcƒÉ datele live...</div>
        </div>

        <div class="data-visualization neon-glow">
            <h3>üìä Metrici Contract - coinmarketcap LIVE</h3>
            <div class="stats-grid" id="etherscanStats">
                <div class="stat-item">
                    <div>Holders</div>
                    <div class="stat-value" id="holdersCount">-</div>
                    <div>De»õinƒÉtori</div>
                </div>
                <div class="stat-item">
                    <div>Total Supply REAL</div>
                    <div class="stat-value" id="totalSupply">-</div>
                    <div>SBYT</div>
                </div>
                <div class="stat-item">
                    <div>Tranzac»õii</div>
                    <div class="stat-value" id="transactionsCount">-</div>
                    <div>Total TX</div>
                </div>
                <div class="stat-item">
                    <div>Market Cap</div>
                    <div class="stat-value" id="marketCap">-</div>
                    <div>USD</div>
                </div>
                <div class="stat-item">
                    <div>Volum 24h</div>
                    <div class="stat-value" id="volume24h">-</div>
                    <div>USD</div>
                </div>
            </div>
        </div>

        <div class="data-visualization neon-glow">
            <h3>üìã Detalii Contract</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-top: 1rem;">
                <div>
                    <p><strong>Token Name:</strong> <span id="tokenName">StancuBYT</span></p>
                    <p><strong>Symbol:</strong> <span id="tokenSymbol">SBYT</span></p>
                    <p><strong>Decimals:</strong> <span id="tokenDecimals">18</span></p>
                    <p><strong>Creation Date:</strong> <span id="creationDate">26.10.2025</span></p>
                </div>
                <div>
                    <p><strong>Contract Address:</strong> <span id="contractCreator">0x44Cf220399be798baeaE45fd7C4fF44623713833</span></p>
                    <p><strong>Contract Age:</strong> <span id="contractAge">-</span> zile</p>
                    <p><strong>Last Update:</strong> <span id="lastUpdateTime">-</span></p>
                    <p><strong>Contract verificat pe Etherscan</strong></p>
                </div>
            </div>
        </div>

        <div class="token-info-grid">
            <div class="info-card">
                <h3>üîç Vezi pe Etherscan</h3>
                <a href="https://etherscan.io/token/0x44Cf220399be798baeaE45fd7C4fF44623713833" 
                   target="_blank" style="color: var(--neon-cyan); text-decoration: none;">
                    AnalizƒÉ detaliatƒÉ Etherscan ‚Ä∫
                </a>
            </div>
            <div class="info-card">
                <h3>üìà Vezi pe DexTools</h3>
                <a href="https://www.dextools.io/app/ether/pair-explorer/0xad4140b82dc8e2249af076b5669a8d868d2d55be8920f0a3882b7149dc507b18?t=1764524205462" 
                   target="_blank" style="color: var(--neon-cyan); text-decoration: none;">
                    Chart live DexTools ‚Ä∫
                </a>
            </div>
            <div class="info-card">
                <h3>ü¶ç Vezi pe Apespace</h3>
                <a href="https://apespace.io/eth/0x83ced65e291d19c436a6f85aaa0a24e47f6e4368" 
                   target="_blank" style="color: var(--neon-cyan); text-decoration: none;">
                    AnalizƒÉ Apespace ‚Ä∫
                </a>
            </div>
        
            <div class="info-card">
                <h3>ü¶é Vezi pe GeckoTerminal</h3>
                <a href="https://www.geckoterminal.com/eth/pools/0xabfa4bdb1b4485e0c590bba4adc93a3980f591e44e7ca17d61aa7420e6b81d07?utm_source=coingecko&utm_medium=referral&utm_campaign=searchresults" 
                   target="_blank" style="color: var(--neon-cyan); text-decoration: none;">
                    Pool & tranzac»õionare GeckoTerminal ‚Ä∫
                </a>
            </div>
            <div class="info-card">
                <h3>üìå Vezi pe CoinMarketCap DEX</h3>
                <a href="https://dex.coinmarketcap.com/token/ethereum/0x44cf220399be798baeae45fd7c4ff44623713833/" 
                   target="_blank" style="color: var(--neon-cyan); text-decoration: none;">
                    coinmarketcap DEX ‚Ä∫
                </a>
            </div>
        </div>
  </section>

  <script>
/* ===================== ENDPOINTS ===================== */
const SBYT_PRICE_ENDPOINT = "https://europe-west1-stancubyt-fc2b9.cloudfunctions.net/sbytPrice";
const HOLDERS_ENDPOINT       = "https://sbytholdersfree-jfka2frgwa-uc.a.run.app";
const TOTALSUPPLY_ENDPOINT   = "https://sbyttotalsupplyfree-jfka2frgwa-uc.a.run.app";
const TX_ENDPOINT            = "https://sbyttxcountfree-jfka2frgwa-uc.a.run.app";
const CONTRACT_INFO_ENDPOINT = "https://sbytcontractinfofree-jfka2frgwa-uc.a.run.app";
const POOL_STATS_ENDPOINT    = "https://europe-west1-stancubyt-fc2b9.cloudfunctions.net/sbytPoolStats";

/* ===================== CONTRACT CREATION (FIXED + AUTO AGE) ===================== */
/* Fix: afiseaza mereu 26 Octombrie 2025 (launch time) si calculeaza automat age */
const CONTRACT_CREATION_ISO_UTC = "2025-10-26T23:23:11Z"; // 26 Oct 2025 11:23:11 PM UTC
function contractCreationMsFallback() {
  const ms = Date.parse(CONTRACT_CREATION_ISO_UTC);
  return Number.isFinite(ms) ? ms : Date.UTC(2025, 9, 26, 23, 23, 11); // safety
}
function calcAgeDaysFromMs(ms){
  if (!Number.isFinite(ms)) return null;
  const diff = Date.now() - ms;
  if (!Number.isFinite(diff)) return null;
  return Math.max(0, Math.floor(diff / 86400000));
}
function renderContractDates(ms){
  const creationEl = document.getElementById("creationDate");
  const ageEl      = document.getElementById("contractAge");
  if (creationEl) creationEl.textContent = new Date(ms).toLocaleDateString("ro-RO");
  const ageDays = calcAgeDaysFromMs(ms);
  if (ageEl) ageEl.textContent = (ageDays == null) ? "‚Äî" : ageDays.toLocaleString("ro-RO");
}

/* ===================== PRICE HISTORY STORAGE ===================== */
const STORAGE_KEY = "sbyt_price_samples_v1";
const MAX_KEEP_DAYS = 31;

/* ===================== UI STATE ===================== */
let currentPeriod = "24h";
let currentMode   = "line";
let priceChart    = null;

let CURRENT_PRICE_USD  = null;
let CURRENT_SUPPLY     = null;
let CURRENT_VOLUME_24H = null;

function nowMs(){ return Date.now(); }

function loadSamples() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    const arr = JSON.parse(raw || "[]");
    if (!Array.isArray(arr)) return [];
    return arr
      .map(s => ({ t: Number(s.t), p: Number(s.p) }))
      .filter(s => Number.isFinite(s.t) && Number.isFinite(s.p))
      .sort((a,b) => a.t - b.t);
  } catch {
    return [];
  }
}

function saveSamples(arr) {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); } catch {}
}

function trimSamples(arr) {
  const cutoff = nowMs() - MAX_KEEP_DAYS * 24*60*60*1000;
  return arr.filter(s => s.t >= cutoff);
}

function addSample(price) {
  let arr = loadSamples();
  arr.push({ t: nowMs(), p: price });
  arr = trimSamples(arr).sort((a,b)=>a.t-b.t);
  if (arr.length > 20000) arr = arr.slice(arr.length - 20000);
  saveSamples(arr);
  return arr;
}

function periodWindowMs(period) {
  switch(period){
    case "1h":  return 1*60*60*1000;
    case "24h": return 24*60*60*1000;
    case "7d":  return 7*24*60*60*1000;
    case "1m":  return 30*24*60*60*1000;
    default:    return 24*60*60*1000;
  }
}

function bucketSizeMs(period) {
  switch(period){
    case "1h":  return 60*1000;
    case "24h": return 15*60*1000;
    case "7d":  return 24*60*60*1000;
    case "1m":  return 24*60*60*1000;
    default:    return 15*60*1000;
  }
}

function fmtLabel(ts){
  const d = new Date(ts);
  if (currentPeriod === "1h" || currentPeriod === "24h") {
    return d.toLocaleTimeString("ro-RO", { hour: "2-digit", minute: "2-digit" });
  }
  if (currentPeriod === "7d") {
    return d.toLocaleDateString("ro-RO", { weekday: "short" });
  }
  return d.toLocaleDateString("ro-RO", { day: "2-digit", month: "2-digit" });
}

function destroyChart() {
  try { if (priceChart) priceChart.destroy(); } catch {}
  priceChart = null;
}

function buildLineSeries(samples, period) {
  const start = nowMs() - periodWindowMs(period);
  const inRange = samples.filter(s => s.t >= start);
  if (!inRange.length) return { labels: [], values: [] };

  if (period === "7d" || period === "1m") {
    const bms = bucketSizeMs(period);
    const buckets = new Map();
    for (const s of inRange){
      const b = Math.floor(s.t / bms) * bms;
      buckets.set(b, s.p);
    }
    const keys = Array.from(buckets.keys()).sort((a,b)=>a-b);
    return { labels: keys.map(fmtLabel), values: keys.map(k => buckets.get(k)) };
  }

  const maxPoints = 300;
  const step = Math.max(1, Math.floor(inRange.length / maxPoints));
  const labels = [];
  const values = [];
  for (let i=0; i<inRange.length; i+=step){
    labels.push(fmtLabel(inRange[i].t));
    values.push(inRange[i].p);
  }
  const last = inRange[inRange.length-1];
  if (labels[labels.length-1] !== fmtLabel(last.t)) {
    labels.push(fmtLabel(last.t));
    values.push(last.p);
  }
  return { labels, values };
}

function buildCandlesSeries(samples, period) {
  const start = nowMs() - periodWindowMs(period);
  const bms = bucketSizeMs(period);
  const inRange = samples.filter(s => s.t >= start);
  if (!inRange.length) return { labels: [], ohlc: [] };

  const buckets = new Map();
  for (const s of inRange){
    const b = Math.floor(s.t / bms) * bms;
    const cur = buckets.get(b);
    if (!cur) buckets.set(b, { o: s.p, h: s.p, l: s.p, c: s.p });
    else { cur.h = Math.max(cur.h, s.p); cur.l = Math.min(cur.l, s.p); cur.c = s.p; }
  }
  const keys = Array.from(buckets.keys()).sort((a,b)=>a-b);
  return { labels: keys.map(fmtLabel), ohlc: keys.map(k => ({ ...buckets.get(k) })) };
}

function renderPriceChart(samples) {
  const canvas = document.getElementById("priceChart");
  if (!canvas) return;
  if (typeof Chart === "undefined") return;

  const ctx = canvas.getContext("2d");
  destroyChart();

  if (currentMode === "candlestick") {
    const { labels, ohlc } = buildCandlesSeries(samples, currentPeriod);
    priceChart = new Chart(ctx, {
      type: "candlestick",
      data: { labels, datasets: [{ label: "SBYT", data: ohlc }] },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { maxRotation: 0, autoSkip: true } },
          y: { beginAtZero: false }
        }
      }
    });
  } else {
    const { labels, values } = buildLineSeries(samples, currentPeriod);
    priceChart = new Chart(ctx, {
      type: "line",
      data: { labels, datasets: [{ label: "SBYT", data: values, tension: 0.25, pointRadius: 0 }] },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { maxRotation: 0, autoSkip: true } },
          y: { beginAtZero: false }
        }
      }
    });
  }
}

function setLastUpdate() {
  const el = document.getElementById("lastUpdateTime");
  if (!el) return;
  el.textContent = new Date().toLocaleString("ro-RO");
}

function updateMarketCapUI() {
  const el = document.getElementById("marketCap");
  if (!el) return;

  if (!Number.isFinite(CURRENT_PRICE_USD) || !Number.isFinite(CURRENT_SUPPLY)) {
    el.textContent = "‚Äî";
    return;
  }

  const mc = CURRENT_PRICE_USD * CURRENT_SUPPLY;
  el.textContent = Number.isFinite(mc) ? mc.toLocaleString("ro-RO", { maximumFractionDigits: 0 }) : "‚Äî";
}

function updateVolumeUI() {
  const el = document.getElementById("volume24h");
  if (!el) return;

  el.textContent = Number.isFinite(CURRENT_VOLUME_24H)
    ? CURRENT_VOLUME_24H.toLocaleString("ro-RO", { maximumFractionDigits: 0 })
    : "‚Äî";
}

/* ===================== LIVE UPDATERS ===================== */
async function updateSBYTPrice() {
  const priceEl = document.getElementById("sbyt-price");
  if (!priceEl) return;

  try {
    const res = await fetch(SBYT_PRICE_ENDPOINT + "?t=" + Date.now(), { cache: "no-store" });
    const data = await res.json();

    const p = Number(data?.priceUsd);
    if (data?.ok && Number.isFinite(p)) {
      priceEl.innerText = "$" + p.toFixed(8);
      CURRENT_PRICE_USD = p;
      updateMarketCapUI();

      const samples = addSample(p);
      renderPriceChart(samples);
      setLastUpdate();
      return;
    }

    priceEl.innerText = "‚Äî";
  } catch {
    priceEl.innerText = "‚Äî";
  }
}

async function updateHolders() {
  const el = document.getElementById("holdersCount");
  if (!el) return;

  el.textContent = "‚Ä¶";
  try {
    const r = await fetch(HOLDERS_ENDPOINT + "?t=" + Date.now(), { cache: "no-store" });
    const d = await r.json();
    const v = Number(d?.holders);
    el.textContent = (d?.ok && Number.isFinite(v)) ? v.toLocaleString("ro-RO") : "0";
    setLastUpdate();
  } catch {
    el.textContent = "0";
  }
}

async function updateTotalSupply() {
  const el = document.getElementById("totalSupply");
  if (!el) return;

  el.textContent = "‚Ä¶";
  try {
    const r = await fetch(TOTALSUPPLY_ENDPOINT + "?t=" + Date.now(), { cache: "no-store" });
    const d = await r.json();
    const supplyNum = parseFloat(String(d?.supply ?? ""));

    if (d?.ok && Number.isFinite(supplyNum)) {
      el.textContent = supplyNum.toLocaleString("ro-RO", { maximumFractionDigits: 0 });
      CURRENT_SUPPLY = supplyNum;
      updateMarketCapUI();
      setLastUpdate();
    } else {
      el.textContent = "‚Äî";
      CURRENT_SUPPLY = null;
      updateMarketCapUI();
    }
  } catch {
    el.textContent = "‚Äî";
    CURRENT_SUPPLY = null;
    updateMarketCapUI();
  }
}

async function updateTransactions() {
  const el = document.getElementById("transactionsCount");
  if (!el) return;

  el.textContent = "‚Ä¶";
  try {
    const r = await fetch(TX_ENDPOINT + "?t=" + Date.now(), { cache: "no-store" });
    const d = await r.json();
    const v = Number(d?.txCount);
    el.textContent = (d?.ok && Number.isFinite(v)) ? v.toLocaleString("ro-RO") : "0";
    setLastUpdate();
  } catch {
    el.textContent = "0";
  }
}

/* FIX IMPORTANT:
   - Creation Date trebuie sa fie 26 Oct 2025
   - Contract Age calculat automat (client-side), chiar daca function-ul da eroare / rate limit
*/
async function updateContractInfo() {
  let ms = null;

  try {
    const r = await fetch(CONTRACT_INFO_ENDPOINT + "?t=" + Date.now(), { cache: "no-store" });
    const d = await r.json();

    if (d?.ok && d.createdAt != null) {
      const raw = d.createdAt;

      if (typeof raw === "string") {
        const t = Date.parse(raw);
        if (Number.isFinite(t)) ms = t;
        else {
          const n = Number(raw);
          if (Number.isFinite(n)) ms = (n > 1e12) ? n : n * 1000;
        }
      } else if (typeof raw === "number") {
        ms = (raw > 1e12) ? raw : raw * 1000;
      }
    }
  } catch {
    // ignore, fallback below
  }

  if (!Number.isFinite(ms)) ms = contractCreationMsFallback();

  renderContractDates(ms);
  setLastUpdate();
}

async function updatePoolStats() {
  const el = document.getElementById("volume24h");
  if (el) el.textContent = "‚Ä¶";

  try {
    const r = await fetch(POOL_STATS_ENDPOINT + "?t=" + Date.now(), { cache: "no-store" });
    const d = await r.json();

    const v = Number(d?.volumeUsd24h);
    CURRENT_VOLUME_24H = (d?.ok && Number.isFinite(v)) ? v : null;

    updateVolumeUI();
    setLastUpdate();
  } catch {
    CURRENT_VOLUME_24H = null;
    updateVolumeUI();
  }
}

/* ===================== BUTTON HANDLERS ===================== */
function syncActiveButtons(){
  document.querySelectorAll(".period-btn").forEach(btn => {
    const oc = (btn.getAttribute("onclick") || "").replace(/\s+/g, "");
    const isPeriod = oc.includes("changeChartPeriod");
    const isType   = oc.includes("changeChartType");
    let active = false;

    if (isPeriod) active = oc.includes(`'${currentPeriod}'`) || oc.includes(`"${currentPeriod}"`);
    if (isType)   active = oc.includes(`'${currentMode}'`)   || oc.includes(`"${currentMode}"`);

    btn.classList.toggle("active", active);
  });
}

window.changeChartPeriod = function(period){
  currentPeriod = period;
  syncActiveButtons();
  renderPriceChart(loadSamples());
};

window.changeChartType = function(mode){
  currentMode = (mode === "candlestick") ? "candlestick" : "line";
  syncActiveButtons();
  renderPriceChart(loadSamples());
};

window.fetchAllData = async function(){
  const btn = document.getElementById("refreshButton");
  if (btn) btn.classList.add("loading");

  try{
    await Promise.allSettled([
      updateSBYTPrice(),
      updateHolders(),
      updateTotalSupply(),
      updateTransactions(),
      updateContractInfo(),
      updatePoolStats()
    ]);

    if (btn) {
      btn.classList.remove("loading");
      btn.classList.add("success");
      setTimeout(()=>btn.classList.remove("success"), 1200);
    }
  } catch {
    if (btn) btn.classList.remove("loading");
  }
};

/* ===================== BOOT ===================== */
document.addEventListener("DOMContentLoaded", () => {
  // Setare imediata corecta (fara sa astepti API)
  renderContractDates(contractCreationMsFallback());

  syncActiveButtons();
  renderPriceChart(loadSamples());

  updateSBYTPrice();
  updateHolders();
  updateTotalSupply();
  updateTransactions();
  updateContractInfo();
  updatePoolStats();

  setInterval(updateSBYTPrice, 30000);
  setInterval(updateHolders, 300000);
  setInterval(updateTotalSupply, 300000);
  setInterval(updateTransactions, 300000);
  setInterval(updateContractInfo, 3600000);
  setInterval(updatePoolStats, 300000);

  // OPTIONAL: ca sa se actualizeze "Contract Age" zilnic chiar daca pagina ramane deschisa
  setInterval(() => renderContractDates(contractCreationMsFallback()), 6 * 60 * 60 * 1000);
});
  </script>
</body>
</html>

